---
title: "p8105_mtp_yc4018"
author: "Yuxuan Chen"
date: "10/28/2021"
output: github_document
---
## Introduction 
and four sections corresponding to the problems below

## Problem 1 – Data.

```{r message = FALSE}
library(tidyverse)

#set the figures' size
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

#set the theme of all graphs
theme_set(theme_minimal() + theme(legend.position = "right"))

#set color of all graphs
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```
1. load, clean, and tidy the mtp_df data
```{r}
mtp_df = readxl::read_excel("./data/p8105_mtp_data.xlsx", range = "A9:I1230") %>%  #read the table without header information
  janitor::clean_names() %>% 
  mutate(
    sex = recode(sex, `1` = "male", `0` = "female"),
    eop_size_mm = if_else(is.na(eop_size_mm), 0, eop_size_mm), # replace NA with 0 in `eop_size_mm` variable. 
    age = as.integer(age),
    age_group = case_when(
      age_group %in% c("6","7","8") ~ "6+",
      TRUE   ~ age_group)) %>% 
  rename(eop_size_group = eop_size, 
         enlarged_eop_group = eop_visibility_classification,
         fhp_group = fhp_category) %>% 
  mutate(
      age_group = fct_relevel(age_group, "1", "2", "3", "4", "5", "6+"),
      eop_size_group = fct_relevel(eop_size_group, "0", "1", "2", "3", "4", "5"),
      enlarged_eop_group = factor(enlarged_eop_group, levels = c("0", "1", "2")),
      fhp_group = fct_relevel(fhp_group,"0", "1", "2", "3", "4", "5","6", "7")
  )
knitr::kable(mtp_df[0:10,])
```

 - Above is the first 10 rows of the resulting dataset. 
 - Data cleaning process: after loading the dataset, I cleaned up the variable names and converted them to lower snake cases. Then based on header information, in `sex` variable, I changed the observations of `1` and `0` to be `male` and `female` respectively, and also replaced NA with 0 in `eop_size_mm` variable. Next, I changed the observations in `age` variable to be the class of integer. Since based on the article, the ages were divided into age groups of 18–30, 31–40, 41–50, 51–60, and >61, so I combined the ages older than 60 as the group of `6+`. Moreover, for naming consistency, I renamed the `eop_size` variable to be `eop_size_group`, `fhp_category` variable to be `fhp_group`. Since "an EOP was classified as enlarged if it exceeded 10 mm and the threshold for recording the size of an EOP was set at 5mm", I renamed `eop_visibility_classification` variable to be `enlarged_eop_group` with observations 0, 1, and 2. Lastly, I ordered the factors for `age_group`,`eop_size_group`,`enlarged_eop_group`, and `fhp_group` categorical variables. \newline.
  - The resulting mtp_df dataset contains 1221 observations of 9 variables. The size of this dataset is  (`r dim(mtp_df)`). I think the key variables are `age_group`, `enlarged_eop_group`, and `fhp_group`, because `age_group` variable categorized different ages into 5 groups of 18–30, 31–40, 41–50, 51–60, and >61, `enlarged_eop_group` represented the sizes of EOP smaller than 5mm or larger than 5mm, and `fhp_group` categorized different FHP sizes into group based on range of 10mm.
  
```{r message = FALSE}
n_ptcp = mtp_df %>% count()

age_sex_df = 
  mtp_df %>% 
  group_by(age_group, sex) %>%
  mutate(
    age_group = recode(
      age_group, "1" = "<18", "2" = "18–30", "3" = "31–40", "4" = "41–50", "5" = "51–60", "6+" = ">60")) %>% 
  summarize(n_obs = n())

age_sex_df %>% 
  pivot_wider(
    names_from = sex,
    values_from = n_obs) %>% 
  knitr::kable(caption = "Age and Gender Distribution")

age_sex_df %>% 
  ggplot(aes(x = age_group, y = n_obs, group = sex, color = sex)) + 
  geom_point(alpha = .5) +
  geom_line(alpha = .5) +
  labs(
    title = "Scatter Plot of Age Distribution Based on Sex",
    x = "Age group",
    y = "Number of Observations"
  )

```

  - There are `r n_ptcp` participants included. Based on the table and the scatter plot, we can see that male and female have the similar distributions of number of observations in each age group. 

